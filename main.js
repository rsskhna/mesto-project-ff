(()=>{"use strict";var e="wff-cohort-4",t="4fe98c95-18ba-48c9-878c-8bb8056c2c44",n="https://nomoreparties.co/v1",o=function(){return fetch(n+"/"+e+"/users/me",{method:"GET",headers:{authorization:t}}).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))},r=document.querySelector("#card-template").content;function c(e,t,n,o,c){var i=r.querySelector(".card").cloneNode(!0),u=i.querySelector(".card__image"),a=i.querySelector(".card__title"),l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__likes-number");return u.src=e.link,u.alt=e.name,a.textContent=e.name,d.textContent=e.likes.length,e.owner._id===c&&(l.classList.add("card__delete-button_active"),l.addEventListener("click",(function(){t(l,e)}))),e.likes.forEach((function(e){e._id===c&&s.classList.add("card__like-button_is-active")})),s.addEventListener("click",(function(t){n(t,e,d)})),u.addEventListener("click",(function(){o(e)})),i}function i(o,r){var c;o.closest(".places__item").remove(),c=r._id,fetch(n+"/"+e+"/cards/"+c,{method:"DELETE",headers:{authorization:t}}).then((function(e){return e})).catch((function(e){return console.log(e)}))}function u(o,r,c){var i;o.target.classList.contains("card__like-button_is-active")?(i=r._id,fetch(n+"/"+e+"/cards/likes/"+i,{method:"DELETE",headers:{authorization:t}}).then((function(e){return e})).catch((function(e){return console.log(e)})),o.target.classList.toggle("card__like-button_is-active"),c.textContent--):(function(o){fetch(n+"/"+e+"/cards/likes/"+o,{method:"PUT",headers:{authorization:t}}).then((function(e){return e})).catch((function(e){return console.log(e)}))}(r._id),o.target.classList.toggle("card__like-button_is-active"),c.textContent++)}var a=document.querySelectorAll(".popup");function l(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}function s(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d)}function d(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");e.preventDefault(),s(t)}}function p(e,t,n){e.classList.remove(n.inputErrorClass),t.classList.remove(n.errorClass),t.textContent=""}function f(e,t){e.disabled=function(e){return e.some((function(e){return!e.validity.valid}))}(t)}function m(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){var c="#".concat(r.name,"-error");p(r,e.querySelector(c),t),f(o,n)}))}a.forEach((function(e){e.classList.add("popup_is-animated")})),a.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_is-opened")||t.target.classList.contains("popup__close"))&&s(e)}))}));var _,v=document.querySelector(".popup_type_edit"),h=v.querySelector(".popup__button"),y=document.querySelector(".popup_type_new-card"),S=y.querySelector(".popup__button"),g=document.querySelector(".popup_type_edit-avatar"),q=g.querySelector(".popup__button"),b=document.querySelector(".popup_type_image"),E=document.querySelector(".popup__image"),L=document.querySelector(".popup__caption"),C=document.querySelector(".places__list"),k=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),T=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),w=document.querySelector(".profile__image"),z=document.forms["edit-profile"],D=z.elements.name,j=z.elements.description,P=document.forms["new-place"],N=P.elements["place-name"],O=P.elements.link,B=document.forms["edit-avatar"],I=B.elements.avatar,J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},M=document.querySelector(".profile__title"),G=document.querySelector(".profile__description"),H=document.querySelector(".profile__image"),U=document.querySelector(".profile__edit-img");function V(e){E.src=e.link,E.alt=e.name,L.textContent=e.name,l(b)}Promise.all([o(),fetch(n+"/"+e+"/cards",{method:"GET",headers:{authorization:t}}).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))]).then((function(e){var t=e.at(0);M.textContent=t.name,G.textContent=t.about,H.style.backgroundImage="url(".concat(t.avatar,")"),e.at(1).map((function(e){return c(e,i,u,V,t._id)})).forEach((function(e){return C.append(e)}))})),_=J,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){!function(e,t){var n=e.querySelector(t.submitButtonSelector),o=Array.from(e.querySelectorAll(t.inputSelector));o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){var o="#".concat(e.name,"-error"),r=t.querySelector(o);e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?p(e,r,n):function(e,t,n){e.classList.add(n.inputErrorClass),t.classList.add(n.errorClass),t.textContent=e.validationMessage}(e,r,n)}(r,e,t),f(n,o)}))}))}(e,_)})),k.addEventListener("click",(function(){h.textContent="Сохранить",D.value=T.textContent,j.value=A.textContent,m(z,J),l(v)})),z.addEventListener("submit",(function(o){o.preventDefault(),T.textContent=D.value,A.textContent=j.value,h.textContent="Сохранение...",function(o,r){return fetch(n+"/"+e+"/users/me",{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o.value,about:r.value})}).then((function(e){return e})).catch((function(e){return console.log(e)}))}(D,j).then((function(e){return s(v)}))})),x.addEventListener("click",(function(){S.textContent="Создать",P.reset(),m(P,J),l(y)})),P.addEventListener("submit",(function(r){r.preventDefault();var a,l,d=c({name:N.value,link:O.value,likes:[],owner:{getUserInfo:o}},i,u,V);C.prepend(d),S.textContent="Сохранение...",(a=N,l=O,fetch(n+"/"+e+"/cards",{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:a.value,link:l.value})}).then((function(e){return e})).catch((function(e){return console.log(e)}))).then((function(e){return s(y)}))})),H.addEventListener("mouseover",(function(){U.classList.add("profile__edit-img_visible")})),H.addEventListener("mouseout",(function(){U.classList.remove("profile__edit-img_visible")})),H.addEventListener("click",(function(){q.textContent="Сохранить",B.reset(),m(B,J),l(g)})),B.addEventListener("submit",(function(o){var r;o.preventDefault(),w.style.backgroundImage="url("+I.value+")",q.textContent="Сохранение...",(r=I,fetch(n+"/"+e+"/users/me/avatar",{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:r.value})}).then((function(e){return e})).catch((function(e){return console.log(e)}))).then((function(e){return s(g)}))}))})();